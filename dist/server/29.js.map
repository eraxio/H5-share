{"version":3,"file":"29.js","sources":["webpack:///./pages/Reward/Publish.vue?9b47","webpack:///./pages/Reward/Publish.vue","webpack:///./pages/Reward/Publish.vue?6ae5","webpack:///./pages/Reward/Publish.vue?1744"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"r-offer\"}},[_vm._ssrNode(\"<div class=\\\"o-offer-bbox\\\" data-v-33da6bc2>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"o-offer-box\\\" data-v-33da6bc2>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"o-offer-title\\\" data-v-33da6bc2><span data-v-33da6bc2>\"+_vm._ssrEscape(_vm._s(_vm.$t('Main09')))+\"</span></div> \"),_c('van-form',{ref:\"oForm\",attrs:{\"validate-first\":\"\"},on:{\"submit\":_vm.handleSubmit}},[_c('div',{staticClass:\"o-offer-content\"},[_c('div',{staticClass:\"o-form\"},[(_vm.step === 0)?[_c('div',{staticClass:\"o-form-item\"},[_c('p',{staticClass:\"o-form-item-label\"},[_vm._v(_vm._s(_vm.$t('Main10')))]),_vm._v(\" \"),_c('van-field',{staticClass:\"o-form-field\",attrs:{\"type\":\"textarea\",\"placeholder\":_vm.$t('Main45'),\"autosize\":{ minHeight: 20,maxHeight: 80},\"rules\":[{required:true}],\"show-word-limit\":\"\",\"maxlength\":\"100\"},model:{value:(_vm.oReward.sSubject),callback:function ($$v) {_vm.$set(_vm.oReward, \"sSubject\", $$v)},expression:\"oReward.sSubject\"}})],1),_vm._v(\" \"),_c('div',{staticClass:\"o-form-item\"},[_c('van-field',{staticClass:\"o-form-choice border\",attrs:{\"type\":\"number\",\"placeholder\":_vm.$t('Main11'),\"rules\":[{required:true}],\"maxlength\":\"4\"},model:{value:(_vm.oReward.sDate),callback:function ($$v) {_vm.$set(_vm.oReward, \"sDate\", $$v)},expression:\"oReward.sDate\"}}),_vm._v(\" \"),_c('van-popup',{staticClass:\"o-popup-f\",attrs:{\"position\":\"bottom\",\"overlay\":true},model:{value:(_vm.sDateShow),callback:function ($$v) {_vm.sDateShow=$$v},expression:\"sDateShow\"}},[_c('van-datetime-picker',{attrs:{\"type\":\"date\",\"title\":_vm.$t('Main11'),\"min-date\":_vm.minDate,\"max-date\":_vm.minCurrentDate,\"cancel-button-text\":_vm.$t('picker1'),\"confirm-button-text\":_vm.$t('picker2')},on:{\"cancel\":_vm.handleCancel,\"confirm\":_vm.handleDateConfirm},model:{value:(_vm.oReward.sDate2),callback:function ($$v) {_vm.$set(_vm.oReward, \"sDate2\", $$v)},expression:\"oReward.sDate2\"}})],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"o-form-item\"},[_c('van-field',{staticClass:\"o-form-choice border\",attrs:{\"is-link\":\"\",\"readonly\":\"\",\"name\":\"iReward\",\"clickable\":\"\",\"placeholder\":_vm.$t('Main12'),\"rules\":[{required:true, validator: _vm.asyncValidator}]},nativeOn:{\"touchstart\":function($event){$event.stopPropagation();_vm.iRewardShow = true}},model:{value:(_vm.oReward.iReward),callback:function ($$v) {_vm.$set(_vm.oReward, \"iReward\", $$v)},expression:\"oReward.iReward\"}}),_vm._v(\" \"),_c('van-number-keyboard',{attrs:{\"theme\":\"custom\",\"extra-key\":['00', '.'],\"show\":_vm.iRewardShow,\"close-button-text\":_vm.$t('Main44')},on:{\"blur\":function($event){_vm.iRewardShow = false},\"close\":_vm.onClose,\"input\":_vm.onInput,\"delete\":_vm.onDelete},model:{value:(_vm.oReward.iReward),callback:function ($$v) {_vm.$set(_vm.oReward, \"iReward\", $$v)},expression:\"oReward.iReward\"}})],1),_vm._v(\" \"),_c('div',{staticClass:\"o-form-item\"},[_c('van-cell',{class:['o-form-choice',{'through':_vm.iAmountCount < 0}],attrs:{\"title\":_vm.$t('Main16'),\"value\":(_vm.iAmountCount + \" NERA\")}})],1)]:_vm._e(),_vm._v(\" \"),(_vm.step === 1)?[_c('div',{staticClass:\"o-form-item\"},[_c('p',{staticClass:\"o-form-item-label\"},[_vm._v(_vm._s(_vm.$t('Main13')))]),_vm._v(\" \"),_c('van-field',{staticClass:\"o-form-field\",attrs:{\"type\":\"textarea\",\"autosize\":{ minHeight: 20,maxHeight: 160},\"show-word-limit\":\"\",\"maxlength\":\"1000\"},model:{value:(_vm.oReward.sDescription),callback:function ($$v) {_vm.$set(_vm.oReward, \"sDescription\", $$v)},expression:\"oReward.sDescription\"}})],1),_vm._v(\" \"),_c('div',{staticClass:\"o-form-item\"},[_c('van-field',{staticClass:\"o-form-choice border\",attrs:{\"placeholder\":_vm.$t('Main14'),\"maxlength\":\"50\"},model:{value:(_vm.oReward.sLocation),callback:function ($$v) {_vm.$set(_vm.oReward, \"sLocation\", $$v)},expression:\"oReward.sLocation\"}})],1),_vm._v(\" \"),_c('div',{staticClass:\"o-form-item\"},[_c('van-field',{staticClass:\"o-form-choice border\",attrs:{\"readonly\":\"\",\"placeholder\":_vm.$t('Main15'),\"is-link\":\"\",\"rules\":[{required:true}]},on:{\"click\":function($event){_vm.iExpirationDateShow = true}},model:{value:(_vm.oReward.iExpirationDate),callback:function ($$v) {_vm.$set(_vm.oReward, \"iExpirationDate\", $$v)},expression:\"oReward.iExpirationDate\"}}),_vm._v(\" \"),_c('van-popup',{staticClass:\"o-popup-f\",attrs:{\"position\":\"bottom\",\"overlay\":true},model:{value:(_vm.iExpirationDateShow),callback:function ($$v) {_vm.iExpirationDateShow=$$v},expression:\"iExpirationDateShow\"}},[_c('van-picker',{attrs:{\"title\":_vm.$t('Main15'),\"show-toolbar\":\"\",\"cancel-button-text\":_vm.$t('picker1'),\"confirm-button-text\":_vm.$t('picker2'),\"columns\":_vm.columns},on:{\"confirm\":_vm.handleDate2Confirm,\"cancel\":_vm.handleCancel}})],1)],1)]:_vm._e()],2)]),_vm._v(\" \"),_c('div',{staticClass:\"o-offer-submit\"},[(_vm.step === 0)?_c('van-button',{staticClass:\"o-btn-submit\",attrs:{\"native-type\":\"submit\"}},[_vm._v(_vm._s(_vm.$t('Main17')))]):_vm._e(),_vm._v(\" \"),(_vm.step === 1)?_c('van-button',{staticClass:\"o-btn-submit\",attrs:{\"native-type\":\"submit\"}},[_vm._v(_vm._s(_vm.$t('Main33')))]):_vm._e()],1)])],2)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {formatTimeToStr, formatNera} from \"../../plugins/utils\";\r\nimport {mapState} from 'vuex'\r\n\r\nexport default {\r\n  name: \"Publish\",\r\n  data() {\r\n    return {\r\n      // step: 0,\r\n      minDate: new Date(1888, 0, 1),\r\n      minCurrentDate: new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()),\r\n      maxDate: new Date(2099, 12, 31),\r\n      sDateShow: false,\r\n      iRewardShow: false,\r\n      iExpirationDateShow: false,\r\n      sLocationShow: false,\r\n      iAmountCount: 0,\r\n      NeraList: [50, 100, 200, 500, 1000],\r\n      dateList: [],\r\n      columns: [\r\n        {text: this.$t('Day01'), value: 3, type: 1},\r\n        {text: this.$t('Day02'), value: 5, type: 1},\r\n        {text: this.$t('Day03'), value: 7, type: 1},\r\n        {text: this.$t('Day04'), value: 1, type: 2},\r\n        {text: this.$t('Day05'), value: 2, type: 2},\r\n        {text: this.$t('Day06'), value: 3, type: 2},\r\n        {text: this.$t('Day07'), value: 4, type: 2},\r\n        {text: this.$t('Day08'), value: 5, type: 2},\r\n        {text: this.$t('Day09'), value: 6, type: 2},\r\n        {text: this.$t('Day10'), value: 7, type: 2},\r\n        {text: this.$t('Day11'), value: 8, type: 2},\r\n        {text: this.$t('Day12'), value: 9, type: 2},\r\n        {text: this.$t('Day13'), value: 10, type: 2},\r\n        {text: this.$t('Day14'), value: 11, type: 2},\r\n        {text: this.$t('Day15'), value: 1, type: 3},\r\n      ],\r\n      oReward: {\r\n        sDate2: new Date(),\r\n        // \"sWallet\": \"0x1B1432B715638d520bd6C20e4fb5C8De65D8ae47\",\r\n        // \"sSubject\": new Date().getTime() + \"年的星空照片,要4k以上\",\r\n        // \"sDate\": \"1205/04/01\",\r\n        // \"sLocation\": \"beijing\",\r\n        // \"iReward\": \"40.36\",\r\n        // \"iExpirationDate\": 1625021721000,\r\n        // \"sDescription\": \"压死猫啦\"\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      step: (state) => state.reward.step,\r\n    }),\r\n    publishStep1() {\r\n      return this.iAmountCount < 0 ||\r\n        !this.oReward.sSubject ||\r\n        !this.oReward.iReward\r\n    }\r\n  },\r\n  watch: {\r\n    step(v) {\r\n      return v\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getAmountCount(0)\r\n  },\r\n  methods: {\r\n    asyncValidator(val, rule) {\r\n      return new Promise(async (resolve) => {\r\n        // console.log(val, rule);\r\n        if (val < 1 || val > 10000) {\r\n          rule['message'] = this.$t('Main12')\r\n          resolve(false)\r\n        }\r\n        this.$toast.loading(this.$t('Main31'));\r\n        let iAmountCount = await this.getAmountCount(val)\r\n        this.$toast.clear();\r\n        if (iAmountCount < 0) {\r\n          rule['message'] = this.$t('Main32')\r\n          resolve(false)\r\n        }\r\n        resolve(true)\r\n      });\r\n    },\r\n    async handleSubmit() {\r\n      if (this.step === 0) {\r\n        this.$store.commit('reward/SET_STEP', 1)\r\n        return\r\n      }\r\n      let data = {\r\n        ...this.oReward,\r\n        iExpirationDate: new Date(this.oReward.iExpirationDate.replace(/-/g, '/') + \" 23:59:59\").getTime()\r\n      }\r\n      let res = await this.$axios.post('/v1/emall/CreateRewardsInfo', data)\r\n\r\n      this.$router.replace({\r\n        name: 'Main',\r\n        params: {\r\n          iRewardId: res.iRewardId\r\n        }\r\n      })\r\n      this.$toast(this.$t('Tip01'))\r\n      this.$store.dispatch('UPDATE_USERINFO')\r\n\r\n      this.$store.commit('reward/SET_STEP', 0)\r\n      console.log(res);\r\n    },\r\n    async getAmountCount(val) {\r\n      let {vBalance} = await this.$axios.post('/v1/udc/GetUserBalance', {\r\n        iAcctType: 0\r\n      })\r\n      // console.log(vBalance);\r\n      if (vBalance.length) {\r\n        vBalance = vBalance[0]\r\n        let iAmount = formatNera(vBalance.iAvailableAmount)\r\n        // console.log(iAmount - val);\r\n\r\n        this.iAmountCount = formatNera(iAmount - val)\r\n        return this.iAmountCount\r\n      }\r\n    },\r\n    onFinish() {\r\n\r\n    },\r\n    handleCancel() {\r\n      this.sDateShow = false\r\n      this.iExpirationDateShow = false\r\n      this.sLocationShow = false\r\n    },\r\n    handleDateConfirm(value) {\r\n      let date = formatTimeToStr(value, 'yyyy-MM-dd')\r\n      this.$set(this.oReward, 'sDate', date)\r\n      this.$set(this.oReward, 'sDate2', date)\r\n      // console.log(date);\r\n      this.handleCancel()\r\n    },\r\n    handleDate2Confirm(value) {\r\n      //  type 1 - 日,  2 - 月, 3 - 年\r\n      let today = new Date()\r\n      switch (value.type) {\r\n        case 1:\r\n          today.setDate(today.getDate() + value.value)\r\n          break\r\n        case 2:\r\n          today.setMonth(today.getMonth() + value.value)\r\n          break\r\n        case 3:\r\n          today.setFullYear(today.getFullYear() + value.value)\r\n          break\r\n      }\r\n      let date = formatTimeToStr(today, 'yyyy-MM-dd')\r\n\r\n      this.$set(this.oReward, 'iExpirationDate', date)\r\n      this.$set(this.oReward, 'iExpirationDate2', date)\r\n      //\r\n\r\n\r\n      this.handleCancel()\r\n    },\r\n    handleLocationConfirm(value, index) {\r\n      // console.log(value.join());\r\n      this.$set(this.oReward, 'sLocation', value.join('/'))\r\n      this.handleCancel()\r\n    },\r\n    onClose(vv) {\r\n      if (!this.oReward.iReward) {\r\n        this.getAmountCount(0)\r\n      }\r\n      this.$refs.oForm.validate('iReward')\r\n    },\r\n    handleDiy(v) {\r\n      // console.log(v);\r\n      this.$set(this.oReward, 'iReward', v.toString())\r\n    },\r\n    onInput() {\r\n\r\n    },\r\n    onDelete() {\r\n\r\n    }\r\n  },\r\n}\r\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Publish.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Publish.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Publish.vue?vue&type=template&id=33da6bc2&scoped=true&\"\nimport script from \"./Publish.vue?vue&type=script&lang=js&\"\nexport * from \"./Publish.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"33da6bc2\",\n  \"33b1c290\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AA7BA;AAwCA;AACA;AAAA;AAEA;AADA;AACA;AAEA;AACA;AAGA;AACA;AATA;AAUA;AACA;AACA;AACA;AACA;AAJA;AACA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAFA;AAIA;AAEA;AACA;AACA;AACA;AADA;AAFA;AAMA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AATA;AACA;AAUA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAhHA;AA9DA;;AC5IA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}